string[8000] buffer;
string[4] match,match2,match3,match4;
string[3] flag,flag2,VAR_UNZ,VAR_LEN;
integer match_len,cnt_UTH,i;
string [256] VAR_RIGHT,VAR_LEFT,VAR_MID,VAR_COUNT,VAR_DELIMITER;
string [256] VAR_PROCESSFLAG,VAR_PROCESSFLAG_VALUE;
VAR_RIGHT="";
VAR_MID="";
VAR_LEFT="";
VAR_DELIMITER="";
VAR_COUNT="";
flag = "N";
flag2="N";
cnt_UTH=0;
VAR_UNZ="";
VAR_LEN="";
match4="";
i=0;
match = "UNH";
match2 = "UNT";
match3 = "UNZ"; 
match4 = "UNB";
match_len = 3; 
while readblock(buffer) do
begin
if left(buffer,match_len) = match then
begin
IF flag = "N"  THEN
BEGIN
writeblock(buffer);
flag="Y";
cnt_UTH=cnt_UTH+1;
END
ELSE
BEGIN
flag="N";
END
end
else if left(buffer,match_len) = match2  then
begin
IF flag2 = "N"  THEN
BEGIN
writeblock(buffer);
flag2="Y";
END
END
else if left(buffer,match_len) = match3  then
begin
VAR_LEFT = left(buffer,4);
VAR_DELIMITER = mid(buffer,3,1);
VAR_MID = mid(buffer,4,len(buffer));
VAR_RIGHT = mid(VAR_MID,strstr(VAR_MID,VAR_DELIMITER),len(VAR_MID));
NTOA(cnt_UTH,VAR_COUNT);
buffer = VAR_LEFT +VAR_COUNT+VAR_RIGHT;
writeblock(buffer);
cnt_UTH=0;
end
else if left(buffer,match_len) = match4  then
BEGIN
VAR_PROCESSFLAG_VALUE=buffer;
WHILE i < 6 do
BEGIN
i=i+1;
VAR_PROCESSFLAG_VALUE = mid(VAR_PROCESSFLAG_VALUE,strstr(VAR_PROCESSFLAG_VALUE,"+")+1,len(VAR_PROCESSFLAG_VALUE));
messagebox(VAR_PROCESSFLAG_VALUE,100);
IF (i = 5) THEN
BEGIN
VAR_PROCESSFLAG = mid(VAR_PROCESSFLAG_VALUE,0,strstr(VAR_PROCESSFLAG_VALUE,"+"));
update processdata set xpathresult = VAR_PROCESSFLAG where xpath = "TranslationOutput/ProcessingFlag1";
END
END
END
else
BEGIN
flag="N";
flag2="N";
writeblock(buffer);
END
end
$TEMP_H2[1].#TEMP_data="123";
